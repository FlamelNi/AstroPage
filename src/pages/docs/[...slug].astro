---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";

export async function getStaticPaths() {
  const docs = await getCollection("docs");
  // Filter out root index (handled by docs/index.astro)
  const docPages = docs.filter((doc) => doc.slug !== "index");

  return docPages.map((entry) => {
    // Normalize slug: remove trailing 'index' segment for directory indexes
    const segments = entry.slug.split("/");
    const slug =
      segments.at(-1) === "index" ? segments.slice(0, -1) : segments;

    return {
      params: { slug: slug.length > 0 ? slug.join("/") : undefined },
      props: { entry },
    };
  });
}

interface Props {
  entry: CollectionEntry<"docs">;
}

const { entry } = Astro.props;
const { Content, headings } = await entry.render();
---

<StarlightPage
  frontmatter={{ title: entry.data.title, description: entry.data.description }}
  headings={headings}
>
  <Content />
</StarlightPage>
